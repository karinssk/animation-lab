{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/garin/OneDrive/Desktop/Projects/animation/app/lib/prisma.ts"],"sourcesContent":["import { PrismaClient } from '@prisma/client'\r\n\r\nconst globalForPrisma = globalThis as unknown as { prisma: PrismaClient }\r\n\r\nexport const prisma = globalForPrisma.prisma || new PrismaClient()\r\n\r\nif (process.env.NODE_ENV !== 'production') globalForPrisma.prisma = prisma\r\n"],"names":[],"mappings":";;;;AAAA;;AAEA,MAAM,kBAAkB;AAEjB,MAAM,SAAS,gBAAgB,MAAM,IAAI,IAAI,sMAAY;AAEhE,wCAA2C,gBAAgB,MAAM,GAAG"}},
    {"offset": {"line": 71, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/garin/OneDrive/Desktop/Projects/animation/app/api/comments/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\nimport { prisma } from \"@/app/lib/prisma\";\nimport fs from \"fs\";\nimport path from \"path\";\n\nexport async function GET(request: NextRequest) {\n  try {\n    const slug = request.nextUrl.searchParams.get(\"slug\")?.trim();\n\n    if (!slug) {\n      return NextResponse.json({ error: \"Missing slug\" }, { status: 400 });\n    }\n\n    const comments = await prisma.comment.findMany({\n      where: { slug },\n      orderBy: { createdAt: \"desc\" },\n    });\n\n    return NextResponse.json(comments);\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: \"Failed to fetch comments\" }, { status: 500 });\n  }\n}\n\nexport async function POST(request: NextRequest) {\n  try {\n    const data = await request.json();\n    const text = typeof data?.text === \"string\" ? data.text : \"\";\n    const image = typeof data?.image === \"string\" ? data.image : null;\n    const slugFromBody = typeof data?.slug === \"string\" ? data.slug : \"\";\n    const slugFromQuery = request.nextUrl.searchParams.get(\"slug\") ?? \"\";\n    const slug = slugFromBody.trim() || slugFromQuery.trim();\n\n    if (!slug) {\n      return NextResponse.json({ error: \"Missing slug\" }, { status: 400 });\n    }\n\n    if (!text.trim() && !image) {\n      return NextResponse.json({ error: \"Comment cannot be empty\" }, { status: 400 });\n    }\n\n    let finalImageUrl: string | null = null;\n\n    if (image && image.startsWith(\"data:image\")) {\n      const base64Data = image.replace(/^data:image\\/\\w+;base64,/, \"\");\n      const buffer = Buffer.from(base64Data, \"base64\");\n      const filename = `upload-${Date.now()}.png`;\n      const uploadDir = path.join(process.cwd(), \"public\", \"uploads\");\n\n      if (!fs.existsSync(uploadDir)) {\n        fs.mkdirSync(uploadDir, { recursive: true });\n      }\n\n      fs.writeFileSync(path.join(uploadDir, filename), buffer);\n      finalImageUrl = `/uploads/${filename}`;\n    }\n\n    const comment = await prisma.comment.create({\n      data: {\n        text: text.trim(),\n        image: finalImageUrl,\n        slug,\n      },\n    });\n\n    return NextResponse.json(comment);\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: \"Failed to create comment\" }, { status: 500 });\n  }\n}\n\nexport async function DELETE(request: NextRequest) {\n  try {\n    const id = request.nextUrl.searchParams.get(\"id\")?.trim();\n    const slug = request.nextUrl.searchParams.get(\"slug\")?.trim();\n\n    if (!id) {\n      return NextResponse.json({ error: \"Missing id\" }, { status: 400 });\n    }\n\n    if (!slug) {\n      return NextResponse.json({ error: \"Missing slug\" }, { status: 400 });\n    }\n\n    const existing = await prisma.comment.findFirst({\n      where: { id, slug },\n      select: { id: true, image: true },\n    });\n\n    if (!existing) {\n      return NextResponse.json({ error: \"Comment not found\" }, { status: 404 });\n    }\n\n    await prisma.comment.delete({\n      where: { id: existing.id },\n    });\n\n    if (existing.image?.startsWith(\"/uploads/\")) {\n      const localImagePath = path.join(process.cwd(), \"public\", existing.image.replace(/^\\/+/, \"\"));\n      if (fs.existsSync(localImagePath)) {\n        fs.unlinkSync(localImagePath);\n      }\n    }\n\n    return NextResponse.json({ success: true });\n  } catch (error) {\n    console.error(error);\n    return NextResponse.json({ error: \"Failed to delete comment\" }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}